{% extends 'base.html' %}
{% load i18n %}
{% load tags %}
{% load activity_tags %}
{% load bootstrap_toolkit %}
{% load avatar_tags %}
{% load common_tags %}
{% load cache %}

{% block content %}
    {% if not request.user.is_authenticated %}
        <div id="why-astrobin" class="carousel slide">
            <div class="carousel-inner">
                <div class="active item">
                    <img src="{{STATIC_URL}}images/M81_astrojoe.jpg" />
                    <div class="carousel-caption">
                        <h4>{% blocktrans %}The perfect home for your astrophotography.{% endblocktrans %}</h4>
                        {% url help as help_url %}
                        <p>{% blocktrans %}AstroBin is an image hosting service made specifically for astrophotographers. It comes packed with features that benefit the astrophotography community greatly! See the <a href="{{help_url}}">help page.</a> for more information.{% endblocktrans %}</p>
                    </div>
                </div>

                <div class="item">
                    <img src="{{STATIC_URL}}images/M42_astrojoe.jpg" />
                    <div class="carousel-caption">
                        <h4>{% blocktrans %}Unlimited uploads, unlimited size.{% endblocktrans %}</h4>
                        <p>{% blocktrans %}Astrophotography images have scientific value that shouldn't be lost in file compression. On AstroBin you can (and should!) upload full size images. And you have unlimited space for free.{% endblocktrans %}</p>
                    </div>
                </div>

                <div class="item">
                    <img src="{{STATIC_URL}}images/M45_astrojoe.jpg" />
                    <div class="carousel-caption">
                        <h4>{% blocktrans %}Have your data neatly plotted.{% endblocktrans %}</h4>
                        <p>{% blocktrans %}Data is everything, and AstroBin will give you the tools to keep your data neat and organized. And with our plots, you can get insights on your productivity and on the gear you use the most.{% endblocktrans %}</p>
                    </div>
                </div>
            </div> <!-- carousel-inner -->

            <a class="carousel-control left" href="#why-astrobin" data-slide="prev">&lsaquo;</a>
            <a class="carousel-control right" href="#why-astrobin" data-slide="next">&rsaquo;</a>
        </div> <!-- carousel -->

        <div class="row section">
            <div class="span5">
                <div class="subtle-container">
                    <div class="header">
                        <h4>{% trans "Recent images" %}</h4>
                    </div>
                    {% image_list request image_list 0 80 %}
                </div>
            </div> <!-- recently uploaded row -->
            <div class="span7">
                <div class="subtle-container">
                    <div class="header">
                        <h4>{% trans "FIT and DSLR camera raw files" %}</h4>
                    </div>
                    <div class="row">
                        <div class="span3">
                            <a href="{% url rawdata.help1 %}">
                                <img src="{{STATIC_URL}}rawdata/images/astrobin-rawdata-plan-galaxia.png"/>
                            </a>
                        </div>
                        <div class="span3">
                            <p>
                                {% blocktrans %}AstroBin offers the storage of FIT and DSLR camera raw files too, for archival and sharing purposes!{% endblocktrans %}
                            </p>
                            <p>
                                {% url rawdata.help1 as rawdata_url %}
                                {% blocktrans %}<strong>AstroBin Raw Data</strong> is a platform for the secure storage of all your FIT and DLSR raw files, up to 500 GB! It will automatically keep your files organized, and allow you to share them with other members. <a href="{{rawdata_url}}">Want to know more?</a>{% endblocktrans %}
                            </p>
                        </div>
                    </div>
                </div>

                <div id="register-button">
                    <a href="/accounts/register/" class="btn btn-primary btn-large">{% trans "Register" %}</a>
                </div>
            </div>
        </div>
    {% else %}<!-- authenticated -->

        {% comment %}
        <div class="hero-unit">
            <div style="float:left; margin-right: 40px; margin-bottom: 20px;">
                <img src="{{STATIC_URL}}images/astrobin-questions-logo.png" alt="AstroBin Questions"/>
            </div>
            <h1>{% trans "Introducing AstroBin Questions" %}</h1>
            <p>
                {% url help_questions as questions_url %}
                {% blocktrans %}After revolutionizing the way astrophotographers preserve their data, AstroBin is set to start a new era in the way amateur astronomers communicate on the Internet. <a href="{{questions_url}}">Want to know more?</a>{% endblocktrans %}
            </p>
            <small>{% trans "PS: AstroBin Questions is only available in English, right now, but more languages will come soon." %}</small>
        </div>
        {% endcomment %}

        {% cache 43200 index_iotd request.LANGUAGE_CODE %}
        {% with image_of_the_day as iotd %}
            <div class="visible-desktop">
                <div class="row section">
                    <div class="span10">
                        <div class="image-of-the-day">
                            <h2>{% trans "Image of the day" %}!</h2>
                            <a href="{% url image_detail iotd.image.id %}">
                                <img src="{{IMAGES_URL}}{{iotd.filename}}.jpg"
                                     alt="{{iotd.image.title|default:_("(no title)")}}"/>
                            </a>
                            <div class="info visible-desktop">
                                <h3>{{iotd.image.title|truncatechars:"60"}}</h3>
                                <span class="by">
                                    {% trans "by" %} <a rel="popover" class="user-popover" data-load="{% url user_popover_ajax iotd.image.user %}"
                                          href="{% url user_page iotd.image.user %}">{{iotd.image.user}}</a>
                                </span>
                                {% for i in gear_list %}
                                    {% if i.1 %}
                                    <p>
                                        <strong>{% trans i.0 %}:</strong>
                                        {% for g in i.1 %}
                                            <a rel="popover" class="gear-popover" data-load="{% url gear_popover_ajax g.id %}" href="{% url gear_page g.id g.slug %}">{% gear_name g %}</a>{% if not forloop.last %},&nbsp;{% endif %}
                                        {% endfor %}
                                    </p>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    <div class="span2">
                        <a class="btn btn-primary btn-upload" href="{% url image_upload %}">
                            <div style="font-size: 92px;"><i class="icon-upload-alt icon-white"></i></div>
                            <span class="text">
                                {% trans "Upload" %}
                            </span>
                        </a>
                    </div>
                </div>
            </div>
        {% endwith %}
        {% endcache %}

        <div class="row">
            <div class="span4"> <!-- all the recent images -->
                <div class="subtle-container">
                    <div class="header">
                        <h4>{% trans "Recent" %}</h4>
                    </div>
                    <div class="thumbs">
                        {% cache 300 index_recent_images request.LANGUAGE_CODE %}
                            {% image_list request image_list 0 64 %}
                        {% endcache %}
                    </div>
                    <div class="more">
                        <a href="{% url wall %}">{% trans "(view more)" %}</a>
                    </div>
                </div>

                {% if recent_from_followees %}
                    <div class="subtle-container">
                        <div class="header">
                            <h4>{% trans "Followed" %}</h4>
                        </div>
                        <div class="thumbs">
                            {% cache 600 index_recent_from_followees request.user %}
                                {% image_list request recent_from_followees 0 64 %}
                            {% endcache %}
                        </div>
                    </div>
                {% endif %}

                {% if recently_five_starred %}
                    <div class="subtle-container">
                        <div class="header">
                            <h4>
                                <img rel="tooltip" title="{% trans "Recently voted 5 stars" %}" alt="" src="{{STATIC_URL}}icons/iconic/white/star_16x16.png"/>
                                <img rel="tooltip" title="{% trans "Recently voted 5 stars" %}" alt="" src="{{STATIC_URL}}icons/iconic/white/star_16x16.png"/>
                                <img rel="tooltip" title="{% trans "Recently voted 5 stars" %}" alt="" src="{{STATIC_URL}}icons/iconic/white/star_16x16.png"/>
                                <img rel="tooltip" title="{% trans "Recently voted 5 stars" %}" alt="" src="{{STATIC_URL}}icons/iconic/white/star_16x16.png"/>
                                <img rel="tooltip" title="{% trans "Recently voted 5 stars" %}" alt="" src="{{STATIC_URL}}icons/iconic/white/star_16x16.png"/>
                            </h4>
                        </div>
                        <div class="thumbs">
                            {% cache 600 index_recent_five_starred request.LANGUAGE_CODE %}
                                {% image_list request recently_five_starred 0 64 %}
                            {% endcache %}
                        </div>
                    </div>
                {% endif %}

                {% if recently_favorited %}
                    <div class="subtle-container">
                        <div class="header">
                            <h4>
                                <img src="{{STATIC_URL}}icons/iconic/white/heart_stroke_16x14.png" alt="{% trans "Recently favorited" %}"/>
                            </h4>
                        </div>
                        <div class="thumbs">
                            {% cache 600 index_recent_favorited request.LANGUAGE_CODE %}
                                {% image_list request recently_favorited 0 64 %}
                            {% endcache %}
                        </div>
                    </div>
                {% endif %}
            </div> <!-- span4 -->

            <div class="span4"> <!-- activity stream -->
                <div class="subtle-container">
                    <div class="header">
                        <h4>{% trans "Activity stream" %}</h4>
                    </div>
                    <div class="activity-actions">
                        {% for action in global_actions %}
                            {% display_action action %}
                        {% empty %}
                            <p>{% trans "There is no activity yet." %}</p>
                        {% endfor %}

                        {% if global_actions.0|length == 16 %}
                            <div class="more">
                                <a href="{% url activities %}">{% trans "(view more)" %}</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div> <!-- span4 -->

            <div class="span4"> <!-- commercial stuff -->
                {% if recent_commercial_gear %}
                    <div class="subtle-container">
                        <div class="header">
                            <h4>{% trans "Commercial products" %}</h4>
                        </div>
                        <div class="thumbs">
                            {% cache 86400 index_recent_commercial_gear request.LANGUAGE_CODE %}
                                {% image_list request recent_commercial_gear 0 64 %}
                            {% endcache %}
                        </div>
                        <div class="more">
                            <a href="{% url wall %}?filter=products">{% trans "(view more)" %}</a>
                        </div>
                    </div>
                {% endif %}

                <div class="subtle-container">
                    <div class="header">
                        <h4>{% trans "Blog" %}</h4>
                    </div>
                    <div class="blog-stream-entries">
                        {% cache 3600 index_blog_entries request.LANGUAGE_CODE %}
                            {% for entry in blog_entries %}
                                <div class="entry">
                                    {% if entry.authors.count %}
                                    <div class="avatar">
                                        <a href="{{entry.authors.all.0}}">{% avatar entry.authors.all.0 64 %}</a>
                                    </div>
                                    {% endif %}

                                    <div class="content">
                                        <div class="meta">
                                            {% if entry.authors.count %}
                                                {{entry.authors.all.0}}:
                                            {% endif %}
                                            <a href="{{entry.get_absolute_url}}">{{entry.title}}</a>
                                        </div>
                                        <p>
                                            {{entry.content|safe|striptags|truncatewords:30}}
                                        </p>
                                    </div>

                                    <div class="when">
                                        {{entry.creation_date|timesince}} {% trans "ago" %}
                                    </div>
                                </div>
                            {% empty %}
                                <p>{% trans "There is no activity yet." %}</p>
                            {% endfor %}
                        {% endcache %}

                        {% if blog_entries|length == 9 %}
                            <div class="more">
                                <a href="/blog/">{% trans "(view more)" %}</a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div> <!-- span4 -->
        </div> <!-- row -->
    {% endif %} {# authenticated #}
{% endblock %}

{% block extra_js %}
<script type="text/javascript">
    $(document).ready(function() {
        astrobin_common.setup_gear_popovers("{% trans "Follow" %}", "{% trans "Unfollow" %}");
        astrobin_common.setup_user_popovers("{% trans "Follow" %}", "{% trans "Unfollow" %}");
    });
</script>
{% endblock %}
