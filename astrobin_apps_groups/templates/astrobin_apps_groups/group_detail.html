{% extends 'base.html' %}

{% load avatar_tags %}
{% load i18n %}
{% load tags %}
{% load pybb_tags %}
{% load sanitizer %}

{% block title %}{{object.name}}{% endblock %}

{% block content %}
    <div class="subnav subnav-fixed">
        <ul class="nav nav-pills">
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="icon-legal icon-white"></i>
                    {% trans "Admin" %}
                    <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                    {% ifequal request.user object.owner %}
                    <li>
                        <a href="{% url 'group_manage_members' object.pk %}">
                            <i class="icon-group"></i>
                            {% trans "Manage members" %}
                        </a>
                    </li>
                    {% endifequal %}
                </ul>
            </li>
        </ul> <!-- nav -->
    </div> <!-- subnav -->

    <div class="row group-header">
        <div class="span9">
            <h1>{{object.name}}</h1>
            {% url 'user_page' object.owner.username as owner_url %}
            <div class="subtitle">
                {% blocktrans with date_created=object.date_created|date:"SHORT_DATE_FORMAT" owner=object.owner.userprofile category=object.category_humanized %}A group created on {{date_created}}, owned by <a href="{{owner_url}}">{{owner}}</a>, categorized as <strong>{{category}}</strong>.{% endblocktrans %}
            </div>
        </div>
        <div class="span3 group-info-container">
            <div class="group-info">
                {% if object.public %}
                    <i class="icon-unlock" rel="tooltip" title="{% trans "This group is public" %}"></i>
                {% else %}
                    <i class="icon-lock icon-inactive" rel="tooltip" title="{% trans "This group is private" %}"></i>
                {% endif %}

                {% if object.moderated %}
                    <i class="icon-legal" rel="tooltip" title="{% trans "This group is moderated" %}"></i>
                {% else %}
                    <i class="icon-legal icon-inactive" rel="tooltip" title="{% trans "This group is not moderated" %}"></i>
                {% endif %}

                {% if object.autosubmission %}
                    <i class="icon-upload-alt" rel="tooltip" title="{% trans "This group has automatic submission" %}"></i>
                {% else %}
                    <i class="icon-upload-alt icon-inactive" rel="tooltip" title="{% trans "This group does not have automatic submission" %}"></i>
                {% endif %}
            </div>

            <div class="group-info">
                <a class="group-info-members" href="#" rel="tooltip" title="{% trans "Members" %}"> <!-- TODO -->
                    {{object.members.count}}
                </a>
            </div>

            <div class="group-info">
                <span class="group-info-images" rel="tooltip" title="{% trans "Images" %}">
                    {{object.images.count}}
                </span>
            </div>
        </div>
    </div>

    <div class="group-description">
        {{object.description|strip_html|safe|linebreaks}}
    </div>

    <div class="group-forum">
        <h2>
            {% trans "Group forum" %}
            <small>
                {% blocktrans with post_count=object.forum.post_count topic_count=object.forum.topic_count %}<strong>{{post_count}}</strong> posts in <strong>{{topic_count}}</strong> topics{% endblocktrans %}
            </small>
        </h2>
        {% with topic_list=object.forum.topics.all|slice:":10" forum=object.forum %}
            {% include 'pybb/topic_list.html' %}
        {% endwith %}
        <div class="group-forum-buttons">
            <a class="btn btn-primary" href="{% url 'pybb:forum' object.forum.id %}">{% trans "View all" %}</a>
            <a class="btn btn-primary" href="{% url 'pybb:add_topic' object.forum.id %}">{% trans "New topic" %}</a>
        </div>
    </div>

    <div class="group-images">
        <h2>{% trans "Images" %}</h2>
        {% image_list image_list %}
    </div>
{% endblock %}
