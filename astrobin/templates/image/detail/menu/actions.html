{% load common_tags %}
{% load i18n %}

{% ifequal request.user image.user %}

<li class="dropdown">
    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
        <i class="icon-bolt icon-white"></i>
        <span class="hidden-phone">{% trans "Actions" %}</span>
        <span class="caret"></span>
    </a>
    <ul class="dropdown-menu">
        {% if request.user == image.user or request.user.is_superuser %}
        <li>
            <a href="{% url 'image_edit_watermark' image.id %}">
                <i class="icon-tint"></i>
                {% trans "Edit watermark" %}
            </a>
        </li>
        <li>
            <a href="{% url 'image_edit_basic' image.id %}">
                <i class="icon-edit"></i>
                {% trans "Edit basic information" %}
            </a>
        </li>
        {% if image.subject_type < 500 %}
            <li>
                <a href="{% url 'image_edit_gear' image.id %}">
                    <i class="icon-cog"></i>
                    {% trans "Edit gear used" %}
                </a>
            </li>
            <li>
                <a href="{% url 'image_edit_acquisition' image.id %}">
                    <i class="icon-time"></i>
                    {% trans "Edit acquisition details" %}
                </a>
            </li>
        {% endif %}

        <li>
            <a href="{% url 'image_edit_license' image.id %}">
                <i class="icon-legal"></i>
                {% trans "Change license" %}
            </a>
        </li>

        <li class="divider"></li>

        <li>
            <a class="upload-revision" href="#upload-revision-modal" data-toggle="modal">
                <i class="icon-upload-alt"></i>
                {% trans "Upload new revision" %}
            </a>
        </li>

        {% if not is_final %}
        <li>
            {% if is_revision %}
                <a href="{% url 'image_edit_revision_make_final' revision_image.id %}">
            {% else %}
                <a href="{% url 'image_edit_make_final' image.id %}">
            {% endif %}

                <i class="icon-ok"></i>
                {% trans "Mark this revision as final" %}
            </a>
        </li>
        {% endif %} <!-- not is_final -->

        <li class="divider"></li>

        {% if is_revision and revision_image.solution or image.solution %}
        <li>
            {% if is_revision %}
                <a href="{% url 'image_edit_plate_solve' image.id revision_image.id %}">
            {% else %}
                <a href="{% url 'image_edit_plate_solve' image.id %}">
            {% endif %}

                <i class="icon-location-arrow"></i>
                {% trans "Attempt to plate-solve again" %}
            </a>
        </li>
        {% endif %}

        <li class="divider"></li>

        {% if image.is_wip %}
        <li>
            <a href="#promote-modal" data-toggle="modal">
                <i class="icon-unlock"></i>
                {% trans "Promote to public area" %}
            </a>
        </li>
        {% else %}
        <li>
            <a href="#demote-modal" data-toggle="modal">
                <i class="icon-lock"></i>
                {% trans "Move to staging area" %}
            </a>
        </li>
        {% endif %} <!-- image.is_wip -->

        <li class="divider"></li>
        <li>
            <a data-toggle="modal" href="#send-to-group-modal">
                <i class="icon-group"></i>
                {% trans "Send to group" %}
            </a>
        </li>

        <li class="divider"></li>
        <li>
            <a data-toggle="modal" href="#send-to-datapool-modal">
                <i class="icon-plus-sign"></i>
                {% trans "Send to public data pool" %}
            </a>
        </li>

        <li>
            <a data-toggle="modal" href="#send-to-sharedfolder-modal">
                <i class="icon-plus-sign"></i>
                {% trans "Send to private shared folder" %}
            </a>
        </li>

        <li class="divider"></li>

        <li>
            <a data-toggle="modal" class="danger" href="#delete-modal">
                <i class="icon-remove"></i>
                {% if revisions %}
                    {% trans "Delete image and all revisions" %}
                {% else %}
                    {% trans "Delete" %}
                {% endif %}
            </a>

            {% if not is_revision and revisions %}
            <a data-toggle="modal" class="danger" href="#delete-original-image-modal">
                <i class="icon-remove"></i>
                {% trans "Delete original image" %}
            </a>
            {% endif %} <!-- revisions -->

            {% if is_revision %}
            <a data-toggle="modal" class="danger" href="#delete-revision-modal">
                <i class="icon-remove"></i>
                {% trans "Delete this revision only" %}
            </a>
            {% endif %} <!--  is_revision -->
        </li>

        {% endif %} <!-- owner or superuser -->

        {% if request.user == image.user or request.user.is_superuser %}
        <li class="divider"></li>
        <li>
            <a data-toggle="modal" href="#flag-thumbnails-modal">
                <i class="icon-flag"></i>
                {% trans "Flag malfunctioning thumbnails" %}
            </a>
        </li>
        {% endif %}
     </ul>
 </li> <!-- actions -->

{% endifequal %} <!-- user is owner -->
