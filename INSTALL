Basic packages:
===============

# We need Mercurial 1.8+ for git submodule support
sudo add-apt-repository ppa:mercurial-ppa/releases

sudo apt-get update
sudo apt-get install \
	apt-file \
	vim \
	git \
	mercury \
	python2.7-dev \
	mysql-server \
	libmysqlclient-dev \
	memcached \
	rabbitmq-server \
	python-pip \
	build-essential \
	uuid-dev \
	libpcre3-dev \
	libcairo2-dev \
	libjpeg8-dev \
	netpbm \
	netpbm10-dev \
	python-numpy
sudo apt-file update
sudo pip install virtualenv

AstroBin instructions:
======================

hg clone https://bitbucket.org/siovene/astrobin astrobin
cd astrobin; virtualenv --no-site-packages venv

. ./venv/binActivate
cd xapian-core-1.2.6
./configure --prefix=/opt && make && sudo make install
cd ../xapian-bindings-1.2.6
XAPIAN_CONFIG=/opt/bin/xapian-config ./configure --prefix=/opt && make && sudo make install
deactivate
	
ln -s ./venv/bin/pip vpip
# setproctitle must be installed first
./vpip install setproctitle
./vpip install \
    yolk \
    django \
    django-haystack xapian-haystack \
    django-celery celerymon \
    gunicorn gunicorn-console \
    django-debug-toolbar \
    MySQL-python \
    django-ratings \
    django-memcached \
    django-storages boto \
    simplejson \
    django-compressor \
    django-registration \
    django-notification \
    flickrapi \
    Pillow \
    python-memcached

# for the notifications system
cd django-persistent-messages
../venv/bin/python setup.py install

mysql -u user -p (password is astrobin)
> create user 'astrobin'@'localhost' identified by 'astrobin';
> create database astrobin;

# Initialize db
./syncdb.sh
(When asked, do create super user astrobin:astrobin <astrobin@astrobin.com>)

# Build nginx
cd nginx-1.0.4
./configure --add-module=../nginx_http_push_module
make
sudo make install

# Use nginx config
Add 'include /home/astrobin/Code/astrobin/astrobin.com.nginx;' to the http{} section of /usr/local/nginx/conf/nginx.conf.

# Configure rabbitmq
sudo rabbitmqctl add_user astrobin astrobin
sudo rabbitmqctl add_vhost astrobin
sudo rabbitmqctl set_permissions -p astrobin astrobin ".*" ".*" ".*"

# Build astrometry.net
cd astrometry.net-0.38
./configure
make
sudo make install

# Create db and index
./scripts/syncdb.sh
./scripts/rebuild_index.sh

# Run it!
./scripts/nginx.sh
./scripts/celeryd.sh &
./scripts/celerybeat.sh &
./scripts/gunicorn.sh &

(replace gunicorn.sh with run.sh if you want to debug)

Go to http://localhost/
