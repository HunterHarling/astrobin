{% extends 'base.html' %}
{% load i18n %}
{% load tags %}

{% block title %}AstroBin - {{user}}{% endblock %}
{% block content %}
    <a name="page_anchor"></a>
    <div class="full-box clear">
        <h2 class="inline profile">
            {% ifequal user request.user %}
                {% blocktrans %}View your images{% endblocktrans %}
            {% else %}
                {% blocktrans with user.username as username %}View {{username}}'s images:{% endblocktrans %}
            {% endifequal %}
        </h2>
        {% ifequal user request.user %}
        <span class="album-links">
            {% if section == 'public' %}
                {% trans "Public Area" %}
            {% else %}
                <a href="{% url me %}">{% trans "Public Area" %}</a>
            {% endif %}
            |
            {% if section == 'staging' %}
                {% trans "Staging Area" %}
            {% else %}
                <a href="?staging">{% trans "Staging Area" %}</a>
            {% endif %}
        </span>
        {% endifequal %}
        <div class="fix"></div>
        {% ifequal user request.user %}
        <p>
            <strong>
            {% if section == 'public' %}
                {% blocktrans %}These are your public images: everybody can see them.{% endblocktrans %}
            {% endif %}
            {% if section == 'staging' %}
                {% blocktrans %}These are your "work in progress" images: only you can see this list. You can show people individual images by sharing them using the <em>Share</em> menu.{% endblocktrans %}
            {% endif %}
            </strong>
        </p>
        {% endifequal %}

        {% if request.user != user and request.user.is_authenticated %}
        <ul class="bar">
            <li id="menu">
                <ul class="topnav">
                    <li id="user" class="first last">
                        <span class="text"><a href="#">{% trans "User" %}</a></span>
                        <span class="small-icon"><a href="#"><img alt="" src="/static/icons/iconic/white/menu.png"/></a></span>
                        <div class="sub">
                            <ul class="subnav">
                                <li class="bg-icon {% if follows %}icon-unfollow{% else %}icon-follow{% endif %}">
                                    <span class="text">
                                        <a class="{% if follows %}unfollow{% else %}follow{% endif %}"
                                           href="{% if follows %}{% url unfollow user %}{% else %}{% url follow user %}{% endif %}{% query_string "next=request.path" "plate_solving_started" %}">
                                            {% if follows %}
                                                {% trans "Stop following" %}
                                            {% else %}
                                                {% trans "Follow" %}
                                            {% endif %}
                                        </a>
                                    </span>
                                </li>
                                <li class="last bg-icon icon-message">
                                    <span class="text"><a class="send-private-message" href="{% url messages_new user %}">{% trans "Send private message" %}</a></span>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            </li>
        </ul>
        {% endif %}
        {% ifequal section 'public' %}
            <span class="album-links">
                {% if subsection == 'uploaded' %}
                    {% trans "Recently uploaded" %}
                {% else %}
                    <a href="?public&sub=uploaded">{% trans "Recently uploaded" %}</a>
                {% endif %}
                |
                {% if subsection == 'subject' %}
                    {% trans "By subject type" %}
                {% else %}
                    <a href="?public&sub=subject">{% trans "By subject type" %}</a>
                {% endif %}
                |
                {% if subsection == 'year' %}
                    {% trans "By year" %}
                {% else %}
                    <a href="?public&sub=year">{% trans "By year" %}</a>
                {% endif %}
                |
                {% if subsection == 'gear' %}
                    {% trans "By gear" %}
                {% else %}
                    <a href="?public&sub=gear">{% trans "By gear" %}</a>
                {% endif %}
                |
                {% if subsection == 'nodata' %}
                    {% trans "Lacking data" %}
                {% else %}
                    <a href="?public&sub=nodata">{% trans "Lacking data" %}</a>
                {% endif %}
            </span>
        {% endifequal %}

        <div class="album">
            {% if section == 'public' and not image_list %}
                {% for album in smart_albums %}
                    {% for title, images in album.items %}
                        {% if images %}
                            <h4>{{title}}</h4>
                            {% ifequal images|length 10 %}
                                <span><a href="?public&sub={{subsection}}&{{subsection}}={{title}}">{% trans "(view more...)" %}</a></span>
                            {% endifequal %}
                            <div class="fix"></div>
                            {% image_list request images 0 %} {% comment %}0 is for False (no pagination){% endcomment %}
                            <div class="fix"></div>
                        {% endif %}
                    {% endfor %}
                {% empty %}
                    {% blocktrans %}No images.{% endblocktrans %}
                {% endfor %}
            {% else %}
                {% if subtitle %}
                    <h4 class="inline">{{subtitle}}</h4> 
                    {% if backlink %}
                        <span><a href="{{backlink}}">{% trans "(go back)" %}</a></span>
                    {% endif %}
                {% endif %}
                {% if subsection == 'nodata' %}
                <p>
                    {% blocktrans %}These images don't have enough data. It's a shame...{% endblocktrans %}
                    {% if request.user = user %}
                        {% blocktrans %}If you want your images to be categorized in albums, you should really fill in some data. Imaging telescopes, imaging cameras and subjects are the bare minimum. Dates of acquisitions are very important too.{% endblocktrans %}
                    {% endif %}
                </p>
                {% endif %}
                {% image_list request image_list %}
            {% endif %}
        </div>
    </div>

    {% if request.user == user %}
    <noscript>
        <div class="tools-box clear">
            <h2>{% trans "Tools" %}</h2>
            <ul>
                <li>
                    <a href="{% url profile_edit_basic %}">
                        <img src="/static/icons/iconic/orange/edit_profile.png" alt="{% trans "Edit profile" %}"/>
                    </a>
                    <a href="{% url profile_edit_basic %}">
                        {% trans "Edit profile" %}
                    </a>
                </li>
                <li>
                    <a href="{% url auth_logout %}">
                        <img src="/static/icons/iconic/orange/logout.png" alt="{% trans "Logout" %}"/>
                    </a>
                    <a href="{% url auth_logout %}">
                        {% trans "Logout" %}
                    </a>
                </li>
            </ul>
        </div>
    </noscript>
    {% endif %}

    <div class="user-card full-box clear">
        <h2>{% blocktrans with user.username as username %}{{username}}'s techical card{% endblocktrans %}</h2>
        <div class="gear">
            <h3>{% trans "Gear" %}</h3>
            {% for i in gear_list %}
                <p>
                    <strong>{% trans i.0 %}:&nbsp;</strong>
                    {% for g in i.1 %}
                        {% if i.2 == 'imaging_telescopes' or i.2 == 'imaging_cameras' %}<a href="/search/?q=&as_values_{{i.2}}={{g.id}}">{{g.name|escape}}</a>{% else %}<a href="/search/?q={{g.name|escape}}&type={{i.2}}">{{g.name|escape}}</a>{% endif %}{% if not forloop.last %},{% endif %}
                    {% endfor %}
                </p>
            {% endfor %}
        </div>
        <div class="stats">
            <h3>{% trans "Stats" %}</h3>
            {% for i in stats %}
                {% if i.1 %}<p><strong>{{i.0}}</strong>: {{i.1}}</p>{% endif %}
            {% endfor %}
        </div>
    </div>
    {% if request.user == user %}
    <p style="text-align: center"><a href="{% url index %}">{% trans "Go to the homepage to upload a new image!" %}</a></p>
    {% endif %}
{% endblock %}

{% block extra_js %}
<script type="text/javascript">
$(document).ready(function() {
    common.init(
        '{{user.username}}',
        {
            follow_action: {
                dialog: {
                    title : "{% blocktrans with image.user.username as username %}Follow {{username}}?{% endblocktrans %}",
                    body  : "{% blocktrans with image.user.username as username %}You will receive a notification every time {{username}} posts a new image. Continue?{% endblocktrans %}",
                    button: "{% trans "Yes, follow!" %}"
                },
                stop_following: "{% trans "Stop following" %}"
            },
            unfollow_action: {
                dialog: {
                    title : "{% blocktrans with image.user.username as username %}Stop following {{username}}?{% endblocktrans %}",
                    body  : "{% blocktrans with image.user.username as username %}You will stop receiving notifications when {{username}} posts a new image. Continue?{% endblocktrans %}",
                    button: "{% trans "Yes, stop following!" %}"
                },
                follow: "{% trans "Follow" %}"
            },
            message_action: {
                dialog: {
                    title : "{% blocktrans with image.user.username as username %}Send {{username}} a message{% endblocktrans %}",
                    body  : "",
                    button: "{% trans "Send" %} &rarr;"
                },
                form_html: '{% autoescape off %}{{private_message_form.as_p|append_slash}}{% endautoescape %}',
                csrf_token: '{{csrf_token}}',
                url      : "{% url send_private_message %}"
            }
        });
});
</script>
{% endblock %}
