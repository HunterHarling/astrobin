{% load astrobin_apps_images_tags %}
{% load common_tags %}
{% load i18n %}

<div class="subnav subnav-fixed">
    <ul class="nav nav-pills">
        <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                <i class="icon-bolt icon-white"></i>
                {% trans "Actions" %}
                <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
                {% if request.user == image.user or request.user.is_superuser %}
                <li>
                    <a href="{% url image_edit_basic image.id %}">
                        <i class="icon-edit"></i>
                        {% trans "Edit basic information" %}
                    </a>
                </li>
                {% if image.subject_type < 500 %}
                    <li>
                        <a href="{% url image_edit_gear image.id %}">
                            <i class="icon-cog"></i>
                            {% trans "Edit gear used" %}
                        </a>
                    </li>
                    <li>
                        <a href="{% url image_edit_acquisition image.id %}">
                            <i class="icon-time"></i>
                            {% trans "Edit acquisition details" %}
                        </a>
                    </li>
                {% endif %}
                {% if not is_final %}
                <li>
                    {% if is_revision %}
                    <a href="{% url image_edit_revision_make_final revision_image.id %}">
                    {% else %}
                    <a href="{% url image_edit_make_final image.id %}">
                    {% endif %}
                        <i class="icon-ok"></i>
                        {% trans "Mark this revision as final" %}
                    </a>
                </li>
                {% endif %} <!-- not is_final -->
                <li class="divider"></li>
                <li>
                    <a href="{% url image_edit_license image.id %}">
                        <i class="icon-legal"></i>
                        {% trans "Change license" %}
                    </a>
                </li>
                <li>
                    <a class="upload-revision" href="#">
                        <i class="icon-upload-alt"></i>
                        {% trans "Upload new revision" %}
                    </a>
                </li>
                {% if image.subject_type == 100 or image.subject_type == 300 %}
                    {% if not image.is_solved and not is_revision %}
                    <li>
                        <a class="plate-solve" href="{% url image_edit_presolve image.id %}{% query_string "done_later=" "plate_solving_started" %}">
                            <i class="icon-screenshot"></i>
                            {% trans "Plate-solve" %}
                        </a>
                    </li>
                    {% else %}
                    <li>
                        <a class="plate-solve" href="{% url image_edit_presolve image.id %}{% query_string "done_later=" "plate_solving_started" %}">
                            <i class="icon-screenshot"></i>
                            {% trans "Plate-solve again" %}
                        </a>
                    </li>
                    {% endif %} <!-- not image.is_solved and not is_revision -->
                {% endif %} <!-- image is deep sky or wide field -->
                {% if image.is_wip %}
                <li>
                    <a href="{% url image_promote image.id %}{% query_string "" "plate_solving_started" %}">
                        <i class="icon-unlock"></i>
                        {% trans "Promote to public area" %}
                    </a>
                </li>
                {% else %}
                <li>
                    <a href="{% url image_demote image.id %}{% query_string "" "plate_solving_started" %}">
                        <i class="icon-lock"></i>
                        {% trans "Move to staging area" %}
                    </a>
                </li>
                {% endif %} <!-- image.is_wip -->

                <li class="divider"></li>
                <li>
                    <a data-toggle="modal" href="#send-to-datapool-modal">
                        <i class="icon-plus-sign"></i>
                        {% trans "Send to public data pool" %}
                    </a>
                </li>

                <li>
                    <a data-toggle="modal" href="#send-to-sharedfolder-modal">
                        <i class="icon-plus-sign"></i>
                        {% trans "Send to private shared folder" %}
                    </a>
                </li>

                <li class="divider"></li>
                <li>
                {% if not is_revision %}
                    {% if revisions %}
                    <a class="delete-original danger" href="{% url image_delete_original image.id %}">
                        <i class="icon-remove"></i>
                        {% trans "Delete original image" %}
                    </a>
                    {% else %}
                    <a class="delete-everything danger" href="{% url image_delete image.id %}">
                        <i class="icon-remove"></i>
                        {% trans "Delete everything" %}
                    </a>
                    {% endif %} <!-- revisions -->
                {% else %}
                    <a class="delete-revision danger" href="{% url image_delete_revision image.id %}">
                        <i class="icon-remove"></i>
                        {% trans "Delete this revision" %}
                    </a>
                {% endif %} <!-- not is_revision -->
                </li>
                {% endif %} <!-- owner or superuser -->
                <li class="divider"></li>
                <li>
                    <a href="{% url bring_to_attention image.id %}">
                        <i class="icon-retweet"></i>
                        {% trans "Bring to a user's attention" %}
                    </a>
                </li>
                {% if image.subject_type == 100 or image.subject_type == 300 %}
                <li class="divider"></li>
                <li>
                    <a class="messier-nomination" href="{% url messier_nomination image.id %}">
                        <i class="icon-book"></i>
                        {% trans "Nominate for the Messier Marathon" %}
                    </a>
                </li>
                {% endif %}
             </ul>
         </li> <!-- actions -->
         <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                <i class="icon-eye-open icon-white"></i>
                {% trans "View" %}
                <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
                {% if mod != 'inverted' and mod != 'solved' %}
                    <li>
                        <a href="{% get_image_url image revision_label %}{% query_string "mod='inverted'" "plate_solving_started" %}">
                            <i class="icon-adjust"></i>
                            {% trans "Inverted monochrome" %}
                        </a>
                    </li>
                    {% if image.is_solved and mod != 'solved' %}
                    <li>
                        {% if is_revision %}
                        <a href="{% get_image_url image revision_label %}{% query_string "mod='solved', r=0" "plate_solving_started" %}">
                            <i class="icon-screenshot"></i>
                            {% trans "Annotated (original version)" %}
                        </a>
                        {% else %} <!-- is_revision -->
                        <a href="{% get_image_url image revision_label %}{% query_string "mod='solved'" "plate_solving_started" %}">
                            <i class="icon-screenshot"></i>
                            {% trans "Annotated" %}
                        </a>
                        {% endif %} <!-- is_revision -->
                    </li>
                    {% endif %} <!-- is_solved and not showing solved -->
                {% endif %} <!-- not showing inverted and not showing solved -->

                {% if mod == 'inverted' %}
                    <li>
                        <a href="{% get_image_url image revision_label %}{% query_string "" "plate_solving_started,mod" %}">
                            <i class="icon-picture"></i>
                            {% trans "Normal" %}
                        </a>
                    </li>
                    {% if image.is_solved and not solved %}
                    <li>
                        {% if is_revision %}
                        <a href="{% get_image_url image '0' %}{% query_string "mod='solved'" "plate_solving_started" %}">
                            <i class="icon-screenshot"></i>
                            {% trans "Annotated (original version)" %}
                        </a>
                        {% else %} <!-- is_revision -->
                        <a href="{% get_image_url image revision_label %}{% query_string "mod='solved'" "plate_solving_started" %}">
                            <i class="icon-screenshot"></i>
                            {% trans "Annotated" %}
                        </a>
                        {% endif %} <!-- is_revision -->
                    </li>
                    {% endif %} <!-- is_solved and not showing solved -->
                {% endif %} <!-- showing inverted -->

                {% if solved %}
                    <li>
                        <a href="{% get_image_url image revision_label %}{% query_string "" "plate_solving_started,mod" %}">
                            <i class="icon-picture"></i>
                            {% trans "Normal" %}
                        </a>
                    </li>
                    <li>
                        <a href="{% get_image_url image revision_label %}{% query_string "mod='inverted'" "plate_solving_started" %}">
                            <i class="icon-adjust"></i>
                            {% trans "Inverted monochrome" %}
                        </a>
                    </li>
                {% endif %} <!-- showing solved -->
            </ul>
        </li> <!-- view -->

        {% if request.user != image.user %}
        <li class="dropdown">
            <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                <i class="icon-user icon-white"></i>
                {% trans "User" %}
                <span class="caret"></span>
            </a>
            <ul class="dropdown-menu">
                <li>
                    <a href="{% url user_page image.user %}">
                        <i class="icon-user"></i>
                        {% trans "View profile" %}
                    </a>
                </li>
                {% if user.is_authenticated %}
                <li>
                    <a class="{% if follows %}unfollow{% else %}follow{% endif %}"
                       href="{% if follows %}{% url unfollow image.user %}{% else %}{% url follow image.user %}{% endif %}{% query_string "next=request.path" "plate_solving_started" %}">
                        {% if follows %}
                            <i class="icon-eye-close"></i>
                            {% trans "Stop following" %}
                        {% else %}
                            <i class="icon-eye-open"></i>
                            {% trans "Follow" %}
                        {% endif %}
                    </a>
                </li>
                {% endif %} <!-- authenticated -->
                <li>
                    <a class="send-private-message" href="{% url messages_compose_to image.user.username %}{% query_string "next=request.path, subject=image.title" "" %}">
                        <i class="icon-envelope"></i>
                        {% trans "Send private message" %}
                    </a>
                </li>
            </ul>
        </li> <!-- user -->
        {% endif %} <!-- not owner -->

        <li>
            <a data-toggle="modal" href="#share-modal">
                <i class="icon-share icon-white"></i>
                {% trans "Share" %}
            </a>
        </li>
    </ul> <!-- nav -->
</div> <!-- subnav -->


