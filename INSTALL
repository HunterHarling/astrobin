Basic packages:
===============

# We need Mercurial 1.8+ for git submodule support
sudo add-apt-repository ppa:mercurial-ppa/releases

sudo apt-get update
sudo apt-get install \
	apt-file \
	vim \
	git \
	mercury \
	python2.7-dev \
	mysql-server \
	libmysqlclient-dev \
	memcached \
	rabbitmq-server \
	python-pip \
	build-essential \
	uuid-dev \
	libpcre3-dev \
	libcairo2-dev \
	libjpeg8-dev \
	netpbm \
	netpbm10-dev \
	python-numpy
sudo apt-file update
sudo pip install virtualenv

AstroBin instructions:
======================

hg clone https://bitbucket.org/siovene/astrobin
cd astrobin.hg; virtualenv --no-site-packages venv

Build xapian-code, xapian-bindings; install in /opt and remember XAPIAN_CONFIG=/opt/bin/xapian-config. Remember to do this while in the virtualenv.
	
ln -s ./venv/bin/pip vpip
./vpip install yolk (to list installed python packaged)
./vpip install django-haystack xapian-haystack (for search)
./vpip install django-celery celerymon (for tasks)
./vpip install setproctitle gunicorn gunicorn-console (for deployment)
./venv/bin/python django-notification django-persistent-messages/setup.py install (for the notifications system)
./vpip install django-debug-toolbar (useful for session debugging in-browser)
./vpip install MySQL-python (for the database backend)
./vpip install django-ratings (for the voting)
./vpip install django-memcached
./vpip install django-storages boto (for s3)
./vpip install simplejson
./vpip install django-compressor (for optimizing bandwidth)
./vpip install django-registration (for users' management)
./vpip install flickrapi
./vpip install Pillow (image manipulation)


mysql -u user -p (password is astrobin)
> create user 'astrobin'@'localhost' identified by 'astrobin';
> create database astrobin;

# Initialize db
./syncdb.sh
(When asked, do create super user astrobin:astrobin <astrobin@astrobin.com>)

# Build nginx
cd nginx-1.0.4
./configure --add-module=../nginx_http_push_module
make
sudo make install

# Use nginx config
Add 'include /home/astrobin/Code/astrobin/astrobin.com.nginx;' to the http{} section of /usr/local/nginx/conf/nginx.conf.

# Configure rabbitmq
sudo rabbitmqctl add_user astrobin astrobin
sudo rabbitmqctl add_vhost astrobin
sudo rabbitmqctl set_permissions -p astrobin astrobin ".*" ".*" ".*"

# Build astrometry.net
cd astrometry.net-0.38
./configure
make
sudo make install

# Run it!
./nginx.sh
./celeryd.sh &
./celerybeat.sh &
./unicorn.sh &

(replace ./unicorn.sh with ./run.sh if you want to debug)

Go to http://localhost/
