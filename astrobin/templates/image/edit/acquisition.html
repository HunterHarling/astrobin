{% extends 'base.html' %}
{% load i18n %}
{% load tags %}

{% block content %}
    {% if image.is_stored %}
        {% include 'image/edit/menu.html' %}
    {% else %}
        {% include 'image/edit/menu_not_ready.html' %}
    {% endif %}


    <div class="sided-main-content">
    <h1>
    {% if image.is_stored %}
        {% trans "Edit your image: acquisition details" %}
    {% else %}
        {% trans "Step 5 of 5: acquisition details" %}
    {% endif %}
    </h1>

    {% form_saved request %}
    {% if edit_type == 'solar_system' %}
        <form id="image_acquisition" action="{% url image_edit_save_acquisition %}" method="post">{% csrf_token %}
            {{ssa_form.as_p}}
            <input type="hidden" name="image_id" value="{{image.id}}" />
            <input type="hidden" name="edit_type" value="solar_system" />
            <ul style="clear:both">
                {% if image.is_stored %}
                    <li><input class="button submit-button" type="submit" value="{% trans "Save" %} &rarr;" /></li>
                    <li><a class="button dangerous-button inline-button" href="{% url image_edit_acquisition_reset image.id %}">{% trans "Remove data" %}</a></li>
                    <li><a href="{{image.get_absolute_url}}/">{% trans "Return to image" %}</a></li>
                {% else %}
                    <li><input type="hidden" name="was_not_ready" value="true"/></li>
                    <li><input class="button submit-button" type="submit" value="{% trans "Save and finish" %} &rarr;" /></li>
                {% endif %}
            </ul>
        </form>
    {% else %}
    {% if edit_type == 'deep_sky' or image.is_solved %}
        {% if advanced or request.GET.advanced == 'true' %}
        <p>
        {% blocktrans %}You can insert as many acquisition sessions as you want, as often images are taken across several nights. An acquisition session is defined primarily by a date and a filter. Fill in your data and then click on <strong>Save</strong> to finish, or on <strong>Add more</strong> to add more acquisition sessions.{% endblocktrans %}
        </p>
        <p>
        {% url image_edit_acquisition image.id as basic_form_url %}
        {% blocktrans %}Is this too much data for you to handle? Go to the <a href="{{basic_form_url}}?edit_type=deep_sky&advanced=false">basic form</a>.{% endblocktrans %}
        </p>
        <form id="image_acquisition" action="{% url image_edit_save_acquisition %}" method="post">{% csrf_token %}
            {% for form in deep_sky_acquisitions %}
                <div id="acquisition-session-{{forloop.counter0}}" class="acquisition-session form_in_set">
                    <h3>{% trans "Acquisition session" %}{% if forloop.first and deep_sky_acquisitions|length > 1 %} {% trans "(scroll down for more)" %}{% endif %}:</h3>
                    {{form.as_p}}
                    <div class="hline"></div>
                </div>
            {% endfor %}
            {{deep_sky_acquisitions.management_form}}
            <input type="hidden" name="image_id" value="{{image.id}}" />
            <input type="hidden" name="edit_type" value="deep_sky" />
            <input type="hidden" name="advanced" value="true"/>
            <ul style="clear:both">
                {% if image.is_stored %}
                    <li><input class="button submit-button" type="submit" value="{% trans "Save" %} &rarr;" /></li>
                    <li><input class="button inline-button" type="submit" value="{% trans "Add more" %}" name="add_more" /></li>
                    <li><a class="button dangerous-button inline-button" href="{% url image_edit_acquisition_reset image.id %}">{% trans "Remove data" %}</a></li>
                    <li><a href="{{image.get_absolute_url}}/">{% trans "Return to image" %}</a></li>
                {% else %}
                    <li><input type="hidden" name="was_not_ready" value="true"/></li>
                    <li><input class="button submit-button" type="submit" value="{% trans "Save and finish" %} &rarr;" /></li>
                    <li><input class="button inline-button" type="submit" value="{% trans "Add more" %}" name="add_more" /></li>
                {% endif %}
            </ul>
        </form>
        {% else %}
        {% url image_edit_acquisition image.id as advanced_form_url %}
        <p>{% blocktrans %}With this form you can input the basic details for the acquisition of your image. If you want to be more thorough or fill in separate details for each filter, go to the <a href="{{advanced_form_url}}?edit_type=deep_sky&advanced=true">advanced form</a>.{% endblocktrans %}</p>
        <form id="image_acquisition" action="{% url image_edit_save_acquisition %}" method="post">{% csrf_token %}
            {{deep_sky_acquisition_basic_form.as_p}}
            <input type="hidden" name="image_id" value="{{image.id}}" />
            <input type="hidden" name="edit_type" value="deep_sky" />
            <input type="hidden" name="advanced" value="false"/>
            <ul style="clear:both">
                {% if image.is_stored %}
                    <li><input class="button submit-button" type="submit" value="{% trans "Save" %} &rarr;" /></li>
                    <li><a class="button dangerous-button inline-button" href="{% url image_edit_acquisition_reset image.id %}">{% trans "Remove data" %}</a></li>
                    <li><a href="{{image.get_absolute_url}}/">{% trans "Return to image" %}</a></li>
                {% else %}
                    <li><input type="hidden" name="was_not_ready" value="true"/></li>
                    <li><input class="button submit-button" type="submit" value="{% trans "Save and finish" %} &rarr;" /></li>
                {% endif %}
            </ul>
        </form>
        {% endif %}
    {% else %}
        <p>{% trans "What kind of image is this?" %}</p>
        <div class="simple-choice">
            <a class="button" href="{% url image_edit_acquisition image.id %}?edit_type=solar_system">
                {% trans "Solar system" %}
            </a>
            <a class="button" href="{% url image_edit_acquisition image.id %}?edit_type=deep_sky">
                {% trans "Deep sky" %}
            </a>
        </div>
    {% endif %}
    {% endif %}
{% endblock %}

{% block extra_js %}
{% if next_acquisition_session > 0 %}
<script type="text/javascript">
$(document).ready(function() {
    $(window).scrollTop($('#acquisition-session-{{next_acquisition_session}}').position().top)
});
</script>
{% endif %}
{% endblock %}

