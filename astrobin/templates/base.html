{% load i18n %}
{% load tags %}
{% load compress %}
{% load inbox %}
{% load avatar_tags %}

<!DOCTYPE html>
<html lang="{% if request.user.is_authenticated and user_language %}{{user_language}}{% else %}en{% endif %}">
    <head>
        <title>{% block title %}AstroBin{% endblock %}</title>

        <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
        <meta name="author" content="Salvatore Iovene - http://iovene.com/" />
        <meta name="description" content="AstroBin is an image hosting website specifically targeted to astrophotographers: it's the first and the last place where you need to upload your astrophotography images. Made by an astrophotographer, for the astrophotographers." />
        <meta name="keywords" content="astrophotography, astronomy, telescopes" />
        <meta name="robots" content="index, follow, noarchive" />
        <meta name="googlebot" content="noarchive" />

        <!-- font -->
        <link href='http://fonts.googleapis.com/css?family=Droid+Sans:400,700' rel='stylesheet' type='text/css'/>

        {% compress css %}
        <!-- 3rd party css -->
        <link rel="stylesheet" type="text/css" media="screen" href="/static/css/jquery-ui.css"/>
        <link rel="stylesheet" type="text/css" media="screen" href="/static/css/jquery-ui-astrobin/jquery-ui-1.8.17.custom.css"/>
        <link rel="stylesheet" type="text/css" media="screen" href="/static/css/ui.multiselect.css"/>
        <link rel="stylesheet" href="/static/css/validationEngine.jquery.css" type="text/css" media="screen" charset="utf-8" />
        <link rel="stylesheet" type="text/css" media="screen" href="/static/css/facebox.css"/>
        <link rel="stylesheet" type="text/css" media="screen" href="/static/css/token-input.css"/>
        <link rel="stylesheet" type="text/css" media="screen" href="/static/css/jquery.multiselect.css"/>
        <link rel="stylesheet" type="text/css" media="screen" href="/static/css/jquery.qtip.css"/>

        <!-- site's css -->
        <link rel="stylesheet" type="text/css" media="screen" href="/static/css/reset.css"/>
        <link rel="stylesheet" type="text/css" media="screen" href="/static/css/bootstrap.css"/>
        <link rel="stylesheet" type="text/css" media="screen" href="/static/css/bootstrap.astrobin.css"/>
        <link rel="stylesheet" type="text/css" media="screen" href="/static/css/astrobin.css"/>


        <!--[if IE 6]><link rel="stylesheet" type="text/css" media="screen" href="/static/css/ie6.css"/><![endif]-->

        {% block extra_css %}{% endblock %}
        {% endcompress %}

        {% block extra_head %}{% endblock %}

        <noscript>
            <style type="text/css">
                form select { width: 70%; }
            </style>
        </noscript>

        <script type="text/javascript">
          var _gaq = _gaq || [];
          _gaq.push(['_setAccount', 'UA-844985-10']);
          _gaq.push(['_setDomainName', 'astrobin.com']);
          _gaq.push(['_setAllowLinker', true]);

          {% if user.is_authenticated %}
          _gaq.push(['_setCustomVar', 1, 'User Type', 'Member']);
          _gaq.push(['_setCustomVar', 2, 'Username', '{{user.username}}']);
          {% else %}
          _gaq.push(['_setCustomVar', 1, 'User Type', 'Anonymous']);
          {% endif %}

          // Reset the custom variables that might be then overriden later.
          _gaq.push(['_setCustomVar', 3, 'Staging Image', 'No']);
          {% block extra_gaq_push %}{% endblock %}

          _gaq.push(['_trackPageview']);

          (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
          })();
        </script>
    </head>

    <body>
        <div class="navbar navbar-fixed-top" id="top">
            <div class="navbar-inner">
                <div class="container">
                    <ul class="nav">
                        <a class="brand" href="{% url index %}">
                            <img src="/static/images/astrobin-logo-square-mini.png" alt="AstroBin" />
                        </a>

                        <li class="{% current request "^/$" %}"><a href="{% url index %}">{% trans "Home" %}</a></li>
                        <li class="{% current request "^/blog/$" %}"><a href="/blog/">{% trans "Blog" %}</a></li>
                        <li class="dropdown {% current request "^/explore/|^/search/|^/stats/" %}">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                {% trans "Explore" %}
                                <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="{% url popular %}">{% trans "Popular subjects" %}</a></li>
                                <li class="divider"></li>
                                <li><a href="{% url wall %}">{% trans "The Big Wall" %}</a></li>
                                <li><a href="{% url nightly %}">{% trans "Night after night" %}</a></li>
                                <li><a href="{% url messier %}">{% trans "Messier marathon" %}</a></li>
                                <li><a href="{% url fits %}">{% trans "TIFF/FITS" %}</a></li>
                                <li class="divider"></li>
                                <li><a href="{% url haystack_search %}">{% trans "Advanced search" %}</a></li>
                                <li><a href="{% url stats %}">{% trans "Stats" %}</a></li>
                            </ul>
                        </li>
                        <li class="dropdown {% current request "^/help/|^/faq/" %}">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                {% trans "Help" %}
                                <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="{% url help %}">{% trans "What is this site?" %}</a></li>
                                <li><a href="{% url faq %}">{% trans "FAQ" %}</a></li>
                                <li class="divider"></li>
                                <li><a href="/contact/">{% trans "Contact" %}</a></li>
                            </ul>
                        </li>
                    </ul>

                    <ul class="nav pull-right">
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                {% trans "Language" %}
                                <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="{% url set_language "en" %}" title="English">
                                        <img src="/static/icons/flags/16/United-Kingdom.png" alt="English"/> English
                                    </a>
                                </li>
                                <li>
                                    <a href="{% url set_language "it" %}" title="Italiano">
                                        <img src="/static/icons/flags/16/Italy.png" alt="Italiano"/> Italiano
                                    </a>
                                </li>
                                <li>
                                    <a href="{% url set_language "es" %}" title="Español">
                                        <img src="/static/icons/flags/16/Spain.png" alt="Español"/> Español
                                    </a>
                                </li>
                                <li>
                                    <a href="{% url set_language "fr" %}" title="Français">
                                        <img src="/static/icons/flags/16/France.png" alt="Français"/> Français
                                    </a>
                                </li>
                                <li>
                                    <a href="{% url set_language "fi" %}" title="Suomi">
                                        <img src="/static/icons/flags/16/Finland.png" alt="Suomi"/> Suomi
                                    </a>
                                </li>
                                <li>
                                    <a href="{% url set_language "de" %}" title="Deutsch">
                                        <img src="/static/icons/flags/16/Germany.png" alt="Deutsch"/> Deutsh
                                    </a>
                                </li>
                                <li>
                                    <a href="{% url set_language "nl" %}" title="Nederlands">
                                        <img src="/static/icons/flags/16/Netherlands.png" alt="Nederlands"/> Nederlands
                                    </a>
                                </li>
                                <li>
                                    <a href="{% url set_language "tr" %}" title="Türk">
                                        <img src="/static/icons/flags/16/Turkey.png" alt="Türk"/> Türk
                                    </a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <a href="http://translate.astrobin.com/" target="_blank">
                                        {% trans "Help with translations!" %}
                                    </a>
                                </li>
                            </ul>
                        </li> <!-- languages -->

                        <li class="divider-vertical"></li>

                        {% if request.user.is_authenticated %}
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                                {% avatar request.user 20 %}
                                {{request.user}}
                                <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="{% url user_page request.user %}">{% trans "My page" %}</a></li>
                                <li><a href="{% url messages_inbox %}">{% trans "My messages" %}</a></li>
                                <li class="divider"></li>
                                <li><a href="{% url profile_edit_basic %}">{% trans "Edit my profile" %}</a></li>
                                <li><a href="{% url auth_logout %}">{% trans "Logout" %}</a></li>
                            </ul>
                        </li> <!-- user menu -->

                        <li class="divider-vertical"></li>

                        <li class="dropdown notice-container">
                            {% if notifications_count > 0 %}
                                <span id="notifications_count" class="notice-count">{{notifications_count}}</span>
                            {% endif %}
                            <a class="dropdown notifications" data-toggle="dropdown" title="{% trans "Notifications" %}" href="#">
                                <img alt="{% trans "Notifications" %}" src="/static/icons/iconic/orange/notifications.gif"/>
                            </a>
                            <ul class="dropdown-menu" id="notifications-popup">
                                {% notification_list request 1 10 %}
                            </ul>
                        </li> <!-- notifications -->
                        
                        <li class="dropdown notice-container"">
                            {% if requests_count > 0 %}
                                <span class="notice-count">{{requests_count}}</span>
                            {% endif %}
                            <a class="dropdown requests" data-toggle="dropdown" title="{% trans "Requests" %}" href="#">
                                <img alt="{% trans "Requests" %}" src="/static/icons/iconic/orange/requests.gif"/>
                            </a>
                            <ul class="dropdown-menu" id="requests-popup">
                                {% request_list request %}
                            </ul>
                        </li> <!-- requests -->
                                                    
                        {% else %} <!-- request.user.is_authenticated -->
                        <li class="{% current request "^/accounts/login/" %}">
                            <a href="{% url auth_login %}">
                                {% if privatebeta_enabled %}
                                    {% trans "Have an invite? Login!" %}
                                {% else %}
                                    {% trans "Login" %}
                                {% endif %}
                            </a>
                        </li>
                        {% if not privatebeta_enabled %}
                        <li class="{% current request "^/accounts/register/" %}">
                            <a href="{% url registration_register %}">{% trans "Register" %}</a>
                        </li>
                        {% endif %}
                    {% endif %} <!-- request.user.is_authenticated -->
                    </ul>

                    <form class="navbar-search pull-right" id="quick-search" action="{% url haystack_search %}" method="get" >
                        <input class="tbox"
                               id="q"
                               type="text"
                               name="q"
                               value="{% trans "Quick search" %}"
                               onfocus="common.clearText(this)"
                               onblur="common.clearText(this)"/>
                        <input type="hidden" name="license" value="0"/>
                        <input type="hidden" name="license" value="1"/>
                        <input type="hidden" name="license" value="2"/>
                        <input type="hidden" name="license" value="3"/>
                        <input type="hidden" name="license" value="4"/>
                        <input type="hidden" name="license" value="5"/>
                        <input type="hidden" name="license" value="6"/>
                    </form>
                </div>
            </div>
        </div>

        {% comment %}
        {% if request.user.is_authenticated and not user_language %}
        <div id="language-prompt">
            <div class="bubble">
                {% blocktrans %}Please select your language from the options above.{% endblocktrans %}
            </div>
        </div>
        {% endif %}
        {% endcomment %}

        <div class="container astrobin-container">
            {% if context_message %}
            <div class="alert {% if context_message.error %}alert-error{% endif %}">
                <p>{{context_message.text}}</p>
            </div>
            {% endif %}

            {% if upload_error %}
            <div class="alert alert-error">
                <p>
                    {% blocktrans %}Invalid image or no image provided. Allowed formats are JPG, PNG and GIF.{% endblocktrans %}
                </p>
            </div>
            {% endif %}

            {% block content %}{% endblock %}
        </div> <!-- container -->

        <footer>
            {% block footer %}
            <div class="container">
                <div class="row">
                    <div class="span3">
                        <h3>{% trans "About" %}</h3>
                        <p>
                        {% trans "AstroBin is an image hosting website specifically targeted to astrophotographers: it's the first and the last place where you need to upload your astrophotography images. Made by an astrophotographer, for the astrophotographers." %}
                        </p>
                    </div>
                    <div class="span3">
                        <h3>{% trans "Site links" %}</h3>
                        <ul>
                            <li><a href="{% url index %}">{% trans "Home" %}</a></li>
                            <li><a href="/blog/">{% trans "Blog" %}</a></li>
                            <li><a href="{% url help %}">{% trans "Help" %}</a></li>
                            <li><a href="{% url faq %}">{% trans "FAQ" %}</a></li>
                            <li><a href="{% url tos %}">{% trans "Terms of Service" %}</a></li>
                            <li><a href="{% url guidelines %}">{% trans "Guidelines" %}</a></li>
                        </ul>
                    </div>
                    <div class="span3">
                        <h3>{% trans "Thanks to" %}</h3>
                        <ul>
                            <li>{% trans "The localization team" %}: <a href="/users/PepeChambo">José J. Chambó</a>, <a href="/users/Tannhauser">Jean-Charles Schmidt</a>, <a href="/users/OrionRider">Laurent Schmitz</a>, <a href="/users/Vostok/">Lauri Kangas</a>, <a href="/users/naavis/">Samuli Vuorinen</a>, <a href="/users/ketarax/">Jussi Kantola</a>, <a href="/users/KoenDierckens/">Koen Dierckens</a>, <a href="http://lambermont.dyndns.org/astro/" target="_blank">Hans Lambermont</a>, <a href="http://strehl1.de" target="_blank">Michael Wilk</a>, <a href="/users/stimpy/">Marc Demierre</a>, <a href="/users/kalle66/">Rinke Kallenkoot</a>, <a href="/users/bilgebay/">Sedat Bilgebay</a>, <a href="/users/onuratilgan/">Onur Atilgan</a>, <a href="/users/guvenozkan/">Güven Özkan</a>, <a href="/users/castle/">Ahmet Kale</a>, <a href="/users/AstroAlb/">Ardian Xherrahi</a>.
                            <li><a href="http://simbad.u-strasbg.fr/simbad/" target="_blank">SIMBAD Astronomical Database</a></li>
                            <li><a href="http://astrometry.net/" target="_blank">Astrometry.net</a></li>
                        </ul>
                    </div>
                    <div class="span3">
                        <h3>{% trans "Copyright" %}</h3>
                        <p>
                        {% blocktrans %}AstroBin is Copyright &copy; 2010-2012 Salvatore Iovene, All Rights Reserved. The images on this websites are copyright of their respective owners.{% endblocktrans %}
                        </p>
                    </div>
                </div> <!-- row -->
                <div class="row bottom">
                    <div class="span9">
                        &copy; 2010-2012 <a href="/users/siovene/">Salvatore Iovene</a>
                    </div>
                    <div class="span3">
                        <a href="{% url index %}">{% trans "Home" %}</a> /
                        <a href="https://plus.google.com/u/0/b/105764284631954214838/" target="_blank">Google+</a> /
                        <a href="http://twitter.com/astrobin_com" target="_blank">Twitter</a> /
                        <a href="#top" class="back-to-top">{% trans "Back to top" %}</a>
                    </div>
                </div> <!-- row -->
            </div> <!-- container -->
            {% endblock %}
        </footer>

        <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="/static/js/flashcanvas.js"></script><![endif]-->
        {% compress js %}
        <script type="text/javascript" src="/static/js/jquery-1.7.1.js"></script>
        <script type="text/javascript" src="/static/js/jquery.i18n.js"></script>
        <script type="text/javascript" src="/static/js/plugins/localization/jquery.localisation.js"></script>
        <script type="text/javascript">
            var dictionary = {
                'Cancel': '{% trans "Cancel" %}'
            }
            $.i18n.setDictionary(dictionary);
        </script>
        <script type="text/javascript" src="/static/js/jquery.uniform.js"></script>
        <script type="text/javascript" src="/static/js/jquery-ui-1.8.16.custom.min.js"></script>

        <script type="text/javascript" src="/static/js/jquery.capty.js"></script>
        <script type="text/javascript" src="/static/js/jquery-ui-timepicker-addon.js"></script>
        <script type="text/javascript" src="/static/js/jquery.validationEngine-en.js"></script>
        <script type="text/javascript" src="/static/js/jquery.validationEngine.js"></script>
        <script type="text/javascript" src="/static/js/jquery.autoSuggest.js"></script>
        <script type="text/javascript" src="/static/js/ui.multiselect.js"></script>
        <script type="text/javascript" src="/static/js/plugins/scrollTo/jquery.scrollTo.js"></script>
        <script type="text/javascript">
            $.localise('ui-multiselect', {
                loadBase: false,
                language: '{{request.LANGUAGE_CODE}}',
                path: '/static/js/locale/',
                timeout: 500
            });
        </script>
        <script type="text/javascript" src="/static/js/ZeroClipboard.js"></script>
        <script type="text/javascript">
            ZeroClipboard.setMoviePath('/static/flash/ZeroClipboard10.swf');
        </script>
        <script type="text/javascript" src="/static/js/facebox.js"></script>
        <script type="text/javascript" src="/static/js/jquery.form.js"></script>
        <script type="text/javascript" src="/static/js/jquery.tokeninput.js"></script>

        <script type="text/javascript" src="/static/js/jquery.flot.js"></script>

        <script type="text/javascript" src="/static/js/jquery.cycle.all.js"></script>
        <script type="text/javascript" src="/static/js/jquery.easing.1.3.js"></script>

        <script type="text/javascript" src="/static/js/Markdown.Converter.js"></script>
        <script type="text/javascript" src="/static/js/Markdown.Sanitizer.js"></script>

        <script type="text/javascript" src="/static/js/jquery.multiselect.js"></script>

        <script type="text/javascript" src="/static/js/jquery.qtip.js"></script>

        <script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
        <script type="text/javascript" src="/static/js/astrobin.js"></script>
        {% endcompress %}

        <!-- javascript -->
        <script type="text/javascript">
            $(window).bind('beforeunload', function() {
                $.each(common.globals.requests, function(i, xhr) {
                    try {
                        xhr.abort();
                    } catch(e) {
                        if (console)
                            console.log('failed to abort xhr');
                    }
                });
                common.globals.requests = [];
            });

            function getInternetExplorerVersion()
            // Returns the version of Internet Explorer or a -1
            // (indicating the use of another browser).
            {
              var rv = -1; // Return value assumes failure.
              if (navigator.appName == 'Microsoft Internet Explorer')
              {
                var ua = navigator.userAgent;
                var re  = new RegExp("MSIE ([0-9]{1,}[\.0-9]{0,})");
                if (re.exec(ua) != null)
                  rv = parseFloat( RegExp.$1 );
              }
              return rv;
            }

            $(document).ready(function() {
                {% if request.user.is_authenticated %}
                var ver = getInternetExplorerVersion();
                if (ver == -1) {
                    common.start_listeners('{{request.user.username}}');
                }
                {%endif %}

                common.init_ajax_csrf_token();

                $('.dropdown-toggle').dropdown();
                $('.carousel').carousel();
                $('.nav-tabs').tab();
                $('[rel=tooltip]').tooltip();

                $('.capty').capty({animation: 'fade', speed: 150, height: 45});
                $('.capty-fixed').capty({animation: 'fixed', height: 45, opacity: 0.6});
                $('.capty-content').show();

                // date and time pickers
                $('input').filter('.timepickerclass').timepicker({});
                $('input').filter('.datepickerclass').datepicker({'dateFormat':'yy-mm-dd'});

                $('input:checkbox, input:radio, input:file').uniform(
                    {fileDefaultText: '{% trans "No file selected" %}',
                     fileBtnText: '{% trans "Choose file" %}'
                    }
                );

                $("select[multiple]").not('*[name="license"]').multiselect({
                    searchable: false,
                    dividerLocation: 0.5
                });

                $('.notice-container a.notifications').click(function(event) {
                    $(document).one('click', function() {
                        notifications_mark_seen();
                    });
                });

                var notifications_read_timer = 0;
                var notifications_mark_seen = function() {
                    $.ajax(
                    {
                        url: '/notifications/seen/',
                        dataType: 'json',
                        success: function() {
                            $('img#notifications').attr('src',
                                '/static/icons/iconic/orange/notifications.gif');
                            $('ul#notification-feed li.unread').removeClass('unread');
                            $('#notifications_count').remove();
                        }
                    });
                };
            });
        </script>

        {% block extra_js %}{% endblock %}
    </body>
</html>

