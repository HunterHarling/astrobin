{% load url from future %}
{% load i18n pybb_tags %}
<form class="post-form" action="
    {% if forum %}
        {% url 'pybb:add_topic' forum.pk %}
    {% else %}
        {% if topic %}
            {% url 'pybb:add_post' topic.pk %}
        {% else %}
            {% url 'pybb:edit_post' pk=object.pk %}
        {% endif %}
    {% endif %}" method="post" enctype="multipart/form-data">
  {% csrf_token %}
  <fieldset>
    {% include "pybb/form_errors.html" %}
    {% if form.name %} {% include "pybb/form_field.html" with field=form.name %} {% endif %}
    {% if form.slug %} {% include "pybb/form_field.html" with field=form.slug %} {% endif %}
    {% if form.login %} {% include "pybb/form_field.html" with field=form.login %}  {% endif %}
    {% if form.body %} {% include "pybb/form_field.html" with field=form.body %}  {% endif %}
    <div id='emoticons'>
      {% for smile, url in form.available_smiles.items %}
        <a href='#' title='{{ smile|safe }}'><img src='{{ STATIC_URL }}{{ form.smiles_prefix }}{{ url }}'></a>
      {% endfor %}
    </div>

    {% if request.user|pybb_may_create_poll and form.poll_type %}
      {% include "pybb/poll_edit_form.html" %}
    {% endif %}
    {% include "pybb/attachments_formset.html" %}
    <p class="submit">{% include "pybb/_button_submit.html" %}</p>
  </fieldset>
</form>

{% block extra_js %}
<script src="{{STATIC_URL}}/tiny_mce/tiny_mce.js"></script>
    <script language="javascript">
    $(document).ready(function() {
        if (window.tinyMCE) {
            tinyMCE.init({
                mode: "exact",
                elements: "id_body",
                theme: "advanced",
                plugins: "autolink,autoresize,bbcode,inlinepopups,lists",
                language: "{{LANGUAGE_CODE}}",
                entity_encoding: "raw",
                add_unload_trigger : false,
                remove_linebreaks : false,
                dialog_type: "modal",

                // Theme options
                theme_advanced_buttons1: "bold,italic,underline,forecolor,|,undo,redo,|,link,unlink,image,|,removeformat,cleanup,code",
                theme_advanced_buttons2: "",
                theme_advanced_buttons3: "",
                theme_advanced_buttons4: "",
                theme_advanced_toolbar_location: "top",
                theme_advanced_toolbar_align: "left",
                theme_advanced_statusbar_location: "none",
                theme_advanced_resizing: true
            });
        }

        $('#emoticons a').click(function() {
            emoticon = $(this).attr("title");
            tinyMCE.activeEditor.execCommand('mceInsertContent', false, emoticon);
            return false;
        });
    });
    </script>
{% endblock %}
