{% extends 'base.html' %}

{% load i18n %}
{% load tags %}

{% block content %}

<a name="page_anchor"></a>
<div class="full-box advanced-search-box">
    <form method="get" action="{% url haystack_search %}">
        {{form.as_p}}
        <input class="button submit-button" type="submit" value="{% trans "Search" %} &rarr;" />
    </form>
</div>

<div id="search-results" class="full-box clear search">
    {% if 'q' in request.GET %}
    <div class="search-links">
            {% trans "Sort by:" %}&nbsp;
            <a href="/search/{% query_string "" "sort" %}">{% trans "Relevance" %}</a>&nbsp;|&nbsp;
            <a href="/search/{% query_string "sort='-uploaded'" "" %}">{% trans "Upload time" %}</a>&nbsp;|&nbsp;
            <a href="/search/{% query_string "sort='-rating'" "" %}">{% trans "Rating" %}</a>&nbsp;|&nbsp;
            <a href="/search/{% query_string "sort='-integration'" "" %}">{% trans "Integration" %}</a>&nbsp;|&nbsp;
            <a href="/search/{% query_string "sort='-views'" "" %}">{% trans "Views" %}</a>
    </div>
    {% search_image_list request page.object_list %}
    {% else %}
    <p class="noterms">{% blocktrans %}Please input some search terms!{% endblocktrans %}</p>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script language="javascript">
    $(document).ready(function() {
        var range = function($input_min, $input_max, min, max, label, unit, help_text) {
            var $first_p = $input_min.closest('p');

            $input_min.closest('p').hide();
            $input_max.closest('p').hide();

            var template = '\
                <label>' + label + ' <span class="min"></span> - <span class="max"></span> ' + unit + '</label>\
                <div class="slider"></div>\
                <span class="helptext">' + help_text + '</span>\
            ';
            var $container = $('<p/>').html(template);
            $container.find('label .min').text($input_min.val() ||Â min);
            $container.find('label .max').text($input_max.val() || max);

            $container.insertBefore($first_p);

            $container.find('.slider').slider({
                range: true,
                min: min,
                max: max,
                values: [$input_min.val() || min, $input_max.val() || max],
                slide: function(event, ui) {
                    $container.find('label .min').text(ui.values[0]);
                    $input_min.val(ui.values[0]);

                    $container.find('label .max').text(ui.values[1]);
                    $input_max.val(ui.values[1]);
                }
            });
        };
        range($('input[name="integration_min"]'),
              $('input[name="integration_max"]'),
              0, 100,
              "{% trans "Integration" %}:",
              "{% trans "hours" %}:",
              ""
        );
        range($('input[name="moon_phase_min"]'),
              $('input[name="moon_phase_max"]'),
              0, 100,
              "{% trans "Avg. Moon phase" %}:",
              "%:",
              ""
        );

        {% autoescape off %}
        {% for key, value in prefill_dict.items %}
        var startText = '{{value.1}}';
        var emptyText = '{{value.2}}';
        var resultsTitleText = '{{value.3}}';
        $('#id_{{key}}').autoSuggest('/autocomplete/{{key}}/',
            {asHtmlID: '{{key}}',
            selectedItemProp: 'id',
            searchObjProps: 'name',
            preFill: {{value.0}},
            selectedItemProp: 'name',
            selectedValuesProp: 'name',
            startText: startText,
            emptyText: emptyText,
            resultsTitleText: resultsTitleText});
        {% endfor %}
        {% endautoescape %}
    });
</script>
{% endblock %}
