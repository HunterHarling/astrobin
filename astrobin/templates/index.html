{% extends 'base.html' %}
{% load i18n %}
{% load tags %}

{% block content %}
    {% if request.user.is_authenticated %}
        {% if upload_form %} 
            <div class="upload-forms">
                <div class="wip-form-box">
                    <h2>{% trans "Upload as a work in progress" %}</h2>
                    <div class="single-form">
                        <div class="loading"><img src="/static/images/ajax-loader.gif" alt=""/></div>
                        <form class="upload" action="{% url image_upload_process %}" method="post" enctype="multipart/form-data">
                            <input type="file" name="file" class="file" id="id_file" size="7"/>
                            <input class="button submit-button" type="submit" value="{% trans "Upload" %}" />
                            <input type="hidden" name="wip" value="" />
                        </form>
                        <div class="progressbar"><img src="/static/images/loading-bar.gif" alt="{% trans "Uploading..." %}"/></div>
                        <p>
                            {% url faq as faq_url %}
                            {% blocktrans %}Use this button to upload an image to the <strong>Staging Area</strong>. It's perfect for works in progress that you want to share on Internet forums. Read more in the <a href="{{faq_url}}#5">FAQ</a>.{% endblocktrans %}
                        </p>
                    </div>
                </div>
                <div class="final-form-box">
                    <h2>{% trans "Upload as a finished image" %}</h2>
                    <div class="single-form">
                        <div class="loading"><img src="/static/images/ajax-loader.gif" alt=""/></div>
                        <form class="upload" action="{% url image_upload_process %}" method="post" enctype="multipart/form-data">
                            <input type="file" name="file" class="file" id="id_file" size="7"/>
                            <input class="button submit-button" type="submit" value="{% trans "Upload" %}" />
                        </form>
                        <div class="progressbar"><img src="/static/images/loading-bar.gif" alt="{% trans "Uploading..." %}"/></div>
                        <p>
                            {% url profile_flickr_import as flickr_url %}
                            {% url me as profile_url %}
                            {% blocktrans %}Use this button to upload an image to the <strong>Public Area</strong>. It will be displayed in <a href="{{profile_url}}">your profile</a> and here on the home page. You can <a href="{{flickr_url}}">import from Flickr</a> too.{% endblocktrans %}
                        </p>
                    </div>
                </div>
            </div>
        {% else %} <!-- upload_form -->
            <div class="full-box missing-gear-warning">
                {% url profile_edit_gear as the_url %}
                <img src="/static/images/dim_upload.png" />
                <h3>{% trans "Warning!" %}</h3>
                <p>
                {% blocktrans %}Before you start uploading images, you have to add at least one telescope and one camera. Do that in <a href="{{the_url}}?initial">your profile</a>!{% endblocktrans %}
                </p>
            </div>
        {% endif %} <!-- upload_form -->
    {% else %}<!-- authenticated -->
        <div id="why-astrobin-nav-container">
            <ul id="why-astrobin-nav"></ul>
        </div>

        <div id="why-astrobin" class="full-box">
            <div class="why-astrobin-page">
                <img src="/static/images/slide1.png" alt=""/>
                <h2>{% blocktrans %}The perfect home for your astrophotography.{% endblocktrans %}</h2>
                {% url help as help_url %}
                <p>{% blocktrans %}AstroBin is an image hosting service made specifically for astrophotographers. It comes packed with features that benefit the astrophotography community greatly! See the <a href="{{help_url}}">help page.</a> for more information.{% endblocktrans %}</p>
            </div>

            <div class="why-astrobin-page" style="display: none">
                <img src="/static/images/slide2.png" alt=""/>
                <h2>{% blocktrans %}Unlimited uploads, unlimited size.{% endblocktrans %}</h2>
                <p>{% blocktrans %}Astrophotography images have scientific value that shouldn't be lost in file compression. On AstroBin you can (and should!) upload full size images. And you have unlimited space for free.{% endblocktrans %}</p>
            </div>

            <div class="why-astrobin-page" style="display: none">
                <img src="/static/images/slide3.png" alt=""/>
                <h2>{% blocktrans %}Have your data neatly plotted.{% endblocktrans %}</h2>
                <p>{% blocktrans %}Data is everything, and AstroBin will give you the tools to keep your data neat and organized. And with our plots, you can get insights on your productivity and on the gear you use the most.{% endblocktrans %}</p>
            </div>
        </div>
    {% endif %}<!-- authenticated -->

    <a name="page_anchor"></a>
    <div class="full-box clear index">
        <h2 class="inline">{% trans "Recent images" %}</h2>
        <span class="album-links">
            {% trans "Sort by:" %}
            {% if sort == '-uploaded' %}
                {% trans "Uploaded" %}
            {% else %}
                <a href="{% url index %}">{% trans "Uploaded" %}</a>
            {% endif %}
            |
            {% if sort == '-acquired' %}
                {% trans "Acquired" %}
            {% else %}
                <a href="{% url index %}{% query_string "sort='-acquired'" "" %}">{% trans "Acquired" %}</a>
            {% endif %}
            |
            {% if sort == '-views' %}
                {% trans "Views" %}
            {% else %}
                <a href="{% url index %}{% query_string "sort='-views'" "" %}">{% trans "Views" %}</a>
            {% endif %}

        </span>
        <hr/>
        {% search_image_list request image_list %}
    </div>
{% endblock %}

{% block extra_js %}
<script type="text/javascript">
    $(document).ready(function() {
        $('#why-astrobin-nav-container').show();
        $('#why-astrobin').css('height', '95px');
        $(function() {
            $('#why-astrobin').cycle({
                fx:     'scrollHorz',
                speed:  'slow',
                timeout: 7000,
                pager:  '#why-astrobin-nav',
                pause: 1,
                startingSlide: Math.floor(Math.random()*3),
                pagerAnchorBuilder: function(idx, slide) { 
                    return '<li><a href="#"></a></li>'; 
                } 
            });
        });

        $('.upload-forms form').submit(function() {
            form = $(this);
            progressbar = form.parent().find('.progressbar');

            form.hide();
            progressbar.show();

            return true;
        });

        $('.upload-forms .loading').hide();
        $('.upload-forms form').show();
    });
</script>
{% endblock %}
